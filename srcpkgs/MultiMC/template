# Template file for 'MultiMC'
pkgname=MultiMC
version=0.6.14
revision=1
archs="x86_64 i686"
wrksrc="MultiMC"
create_wrksrc=yes
depends="virtual?java-environment qt5-svg"
short_desc="Instanced Minecraft client"
maintainer="Orphaned <orphan@voidlinux.org>"
license="Apache-2.0"
homepage="http://multimc.org"

case "$XBPS_TARGET_MACHINE" in
	i686)_arch="32"
	checksum="5ea54392e35e97f7123ddf669ebd02271474a758a75f4fecc0acd4f6eb240829 ";;
	x86_64)_arch="64"
	checksum="b99051b70903c7229877c9c2bc2ccaf1c20bb2510a5e4082d0113331bd321023 ";;
	*)broken="aarch* and arm* binaries are not shipped by upstream!";;
esac
_debver=1.6-1

distfiles="https://files.multimc.org/downloads/mmc-stable-lin${_arch}.tar.gz
https://files.multimc.org/downloads/multimc_${_debver}.deb"
checksum+=d30b2577463178fd3cbe0dd30e68a30be3f85d8f50f8052e844a43acf4b46e0f
nopie=yes
nodebug=yes

# Restricted since we don't have permissions to ship builds with the
# MultiMC name, artwork or the API endpoints.
restricted=yes

do_extract() {
	bsdtar -xf ${XBPS_SRCDISTDIR}/${pkgname}-${version}/multimc_${_debver}.deb
	bsdtar -xf data.tar.xz
	bsdtar -xf ${XBPS_SRCDISTDIR}/${pkgname}-${version}/mmc-stable-lin${_arch}.tar.gz
}

do_install() {
	vmkdir usr/libexec/multimc
	vmkdir usr/bin
	vmkdir usr/share/applications
	vmkdir usr/share/pixmaps
	vbin ${FILESDIR}/MultiMC.sh MultiMC
	cp -R ./MultiMC/bin/* ${DESTDIR}/usr/libexec/multimc
	chmod 755 ${DESTDIR}/usr/libexec/multimc/*.so
	mv ${DESTDIR}/usr/libexec/multimc/MultiMC ${DESTDIR}/usr/libexec/multimc/multimc
	mv opt/multimc/icon.svg ${DESTDIR}/usr/share/pixmaps/multimc.svg
	mv usr/share/applications/multimc.desktop ${DESTDIR}/usr/share/applications/
	chmod 644 ${DESTDIR}/usr/share/applications/multimc.desktop
	vsed -i ${DESTDIR}/usr/share/applications/multimc.desktop -e 's%Exec=/opt/multimc/run.sh%Exec=MultiMC%'
	vsed -i ${DESTDIR}/usr/share/applications/multimc.desktop -e 's%Icon=/opt/multimc/icon.svg%Icon=multimc%'
	chmod 644 ${DESTDIR}/usr/share/pixmaps/multimc.svg
}
